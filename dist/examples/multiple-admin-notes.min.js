(()=>{AMF.plugin("Multiple Admin Notes",()=>{AMF.on("content-frame-load",({contentWindow:f})=>{let{document:a}=f,o=a.querySelector("textarea[name='notes']");if(!o)return;let b=o.closest("form"),t;try{if(t=JSON.parse(o.value),!Array.isArray(t)||t.length===0)throw new Error("Notes are not a valid array structure")}catch(e){t=[{title:"",content:o.value}]}let u=o.parentElement;u.style.display="none";let p=a.createElement("style");p.textContent=`
        .flex {
            display: flex;
        }
        .flex-col {
            flex-direction: column;
        }
        #notes-container {
            padding-right: 10px;
        }
        .notes-sidebar {
            width: 150px;
            margin-right: 10px;
        }
        .notes-list button {
            width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            text-align: left;
        }
        .notes-list button[data-active="true"] {
            font-weight: bold;
        }
        .flex-1 {
            flex: 1;
        }
        .notes-textarea {
            width: 100%;
        }
        .notes-title {
            width: 100%;
        }
        .notes-list {
            max-height: 190px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-radius: 3px;
            margin-bottom: 5px;
        }
        .notes-add-button {
            margin-bottom: 5px;
        }
    `,a.head.appendChild(p);let n=a.createElement("div");n.id="notes-container",n.innerHTML=`
        <div class="flex">
            <div class="flex flex-col notes-sidebar">
                <button class="notes-add-button" id="button" type="button">New note</button>
                <div class="notes-list"></div>
            </div>
            <div class="flex-1">
                <div class="flex">
                    <div class="flex-1">
                        <input type="text" placeholder="Title" class="notes-title" />
                    </div>
                    <button class="notes-delete-button" id="button" type="button">X</button>
                </div>
                <textarea class="notes-textarea" rows="16"></textarea>
            </div>
        </div>`;let c=n.querySelector(".notes-textarea"),d=n.querySelector(".notes-title"),v=n.querySelector(".notes-list"),l=0;function i(e){if(l=e,t[e])c.value=t[e].content,d.value=t[e].title;else c.value="",d.value="";x()}c.addEventListener("input",(e)=>{t[l].content=e.target.value}),d.addEventListener("input",(e)=>{t[l].title=e.target.value,x()}),b.addEventListener("submit",(e)=>{o.value=JSON.stringify(t)}),n.querySelector(".notes-add-button").addEventListener("click",(e)=>{t.push({title:"",content:""}),i(t.length-1)}),n.querySelector(".notes-delete-button").addEventListener("click",(e)=>{if(t.splice(l,1),t.length===0)t.push({title:"",content:""});i(Math.min(l,t.length-1))});function x(){v.innerHTML="",t.forEach((e,r)=>{let s=a.createElement("button");if(s.type="button",s.textContent=e.title||`Note ${r+1}`,s.dataset.index=r,r===l)s.dataset.active="true";s.addEventListener("click",()=>{i(r)}),v.appendChild(s)})}i(0),u.parentElement.appendChild(n)})});})();
